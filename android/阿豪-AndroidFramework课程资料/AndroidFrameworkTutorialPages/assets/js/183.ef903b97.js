(window.webpackJsonp=window.webpackJsonp||[]).push([[183],{614:function(a,t,s){"use strict";s.r(t);var n=s(2),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("我们从 DisplayContent 的构造函数出发，看一下这棵以 DisplayContent 为根节点的 DisplayArea 树是如何生成的。")]),a._v(" "),t("h2",{attrs:{id:"_1-displaycontent-构造函数分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-displaycontent-构造函数分析"}},[a._v("#")]),a._v(" 1. DisplayContent 构造函数分析")]),a._v(" "),t("p",[a._v("DisplayContent 类的构造函数：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayContent.java")]),a._v("\n\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Create new {@link DisplayContent} instance, add itself to the root window container and\n     * initialize direct children.\n     * @param display May not be null.\n     * @param root {@link RootWindowContainer}\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayContent")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Display")]),a._v(" display"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RootWindowContainer")]),a._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@NonNull")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DeviceStateController")]),a._v(" deviceStateController"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ......")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("configureSurfaces")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("pendingTransaction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ......")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Configures the surfaces hierarchy for DisplayContent\n     * This method always recreates the main surface control but reparents the children\n     * if they are already created.\n     * @param transaction as part of which to perform the configuration\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("configureSurfaces")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Transaction")]),a._v(" transaction"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ......")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mDisplayAreaPolicy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Setup the policy and build the display area hierarchy.")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Build the hierarchy only after creating the surface so it is reparented correctly")]),a._v("\n            mDisplayAreaPolicy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mWmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getDisplayAreaPolicyProvider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n                    mWmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* content */")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* root */")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    mImeWindowsContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("      \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ...... ")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br")])]),t("p",[a._v("在 DisplayContent 的构造方法中，调用 DisplayAreaPolicy.Provider.instantiate 方法，去初始化一个 DisplayArea 层级结构。")]),a._v(" "),t("p",[a._v("DisplayAreaPolicy.Provider 只是一个接口，接口中 instantiate 方法的定义：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n         * Instantiates a new {@link DisplayAreaPolicy}. It should set up the {@link DisplayArea}\n         * hierarchy.\n         *\n         * @see DisplayAreaPolicy#DisplayAreaPolicy\n         */")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayAreaPolicy")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerService")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayContent")]),a._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RootDisplayArea")]),a._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),a._v(" imeContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[a._v("实际运行的代码是 DisplayAreaPolicy.Provider 的实现类 DisplayAreaPolicy.DefaultProvider 的 instantiate 方法：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicy.java")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayAreaPolicy")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerService")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayContent")]),a._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RootDisplayArea")]),a._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),a._v(" imeContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// new 一个 TaskDisplayArea 对象")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TaskDisplayArea")]),a._v(" defaultTaskDisplayArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TaskDisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"DefaultTaskDisplayArea"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_DEFAULT_TASK_CONTAINER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// new 一个 List，然后把刚 new 的TaskDisplayArea 对象插入")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("TaskDisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" tdaList "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            tdaList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("defaultTaskDisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// HierarchyBuilder 对应用于统筹管理整个树的构建过程")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 传入的参数 root 就是窗口层级树的根节点 DisplayContent")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HierarchyBuilder")]),a._v(" rootHierarchy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HierarchyBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 将 imeContainer 以及刚创建的 list 保存到 HierarchyBuilder 对象的成员变量中  ")]),a._v("\n            rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setImeContainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("imeContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setTaskDisplayAreas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("tdaList"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("isTrusted")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// isTrusted 表示当前屏幕是否是主屏幕")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Only trusted display can have system decorations.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 初始化好 feature")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("configureTrustedHierarchyBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        \n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 生成 DisplayArea 层级结构")]),a._v("\n             "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayAreaPolicyBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setRootHierarchy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br")])]),t("p",[a._v("instantiate 方法大致干了两件事：")]),a._v(" "),t("ul",[t("li",[a._v("初始化一个 HierarchyBuilder 对象，同时初始化好内部的三个成员变量 "),t("code",[a._v("RootDisplayArea mRoot ArrayList<TaskDisplayArea> mTaskDisplayAreas DisplayArea.Tokens mImeContainer")])]),a._v(" "),t("li",[a._v("调用 "),t("code",[a._v("configureTrustedHierarchyBuilder")]),a._v(" 方法初始化好 Feature 列表")]),a._v(" "),t("li",[a._v("调用 "),t("code",[a._v("new DisplayAreaPolicyBuilder().setRootHierarchy(rootHierarchy).build(wmService)")]),a._v(" 生成 DisplayArea 层级结构")])]),a._v(" "),t("h2",{attrs:{id:"_2-pendingarea-树构建过程初步"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-pendingarea-树构建过程初步"}},[a._v("#")]),a._v(" 2. PendingArea 树构建过程初步")]),a._v(" "),t("p",[a._v("接下来我们就来看 "),t("code",[a._v("configureTrustedHierarchyBuilder")]),a._v("  方法的具体实现：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicy.java")]),a._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("configureTrustedHierarchyBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HierarchyBuilder")]),a._v(" rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerService")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayContent")]),a._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// WindowedMagnification should be on the top so that there is only one surface")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// to be magnified.")]),a._v("\n            rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"WindowedMagnification"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_WINDOWED_MAGNIFICATION")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("upTo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Make the DA dimmable so that the magnify window also mirrors the dim layer.")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setNewDisplayAreaSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Dimmable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("isDefaultDisplay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Only default display can have cutout.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// See LocalDisplayAdapter.LocalDisplayDevice#getDisplayDeviceInfoLocked.")]),a._v("\n                rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"HideDisplayCutout"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_HIDE_DISPLAY_CUTOUT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR_PANEL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_STATUS_BAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NOTIFICATION_SHADE")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"OneHanded"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_ONE_HANDED")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 24 25 33")]),a._v("\n                                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR_PANEL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                        "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SECURE_SYSTEM_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            rootHierarchy\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"FullscreenMagnification"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_FULLSCREEN_MAGNIFICATION")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("all")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                    "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD_DIALOG")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                    "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR_PANEL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ImePlaceholder"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_IME_PLACEHOLDER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("and")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD_DIALOG")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br"),t("span",{staticClass:"line-number"},[a._v("38")]),t("br"),t("span",{staticClass:"line-number"},[a._v("39")]),t("br"),t("span",{staticClass:"line-number"},[a._v("40")]),t("br"),t("span",{staticClass:"line-number"},[a._v("41")]),t("br"),t("span",{staticClass:"line-number"},[a._v("42")]),t("br"),t("span",{staticClass:"line-number"},[a._v("43")]),t("br")])]),t("p",[a._v("这里几段代码都是类似的：")]),a._v(" "),t("ul",[t("li",[a._v("通过 Feature.Builder 构造一个 Feature 对象")]),a._v(" "),t("li",[a._v("再调用 HierarchyBuilder 对象的 addFeature 方法，将构造好的 Feature 对象保存到 HierarchyBuilder 对象内部的 "),t("code",[a._v("ArrayList<DisplayAreaPolicyBuilder.Feature> mFeatures")]),a._v(" 成员中")])]),a._v(" "),t("p",[a._v("我们以第一段代码为例看下具体的实现：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("            rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"WindowedMagnification"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_WINDOWED_MAGNIFICATION")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("upTo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Make the DA dimmable so that the magnify window also mirrors the dim layer.")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setNewDisplayAreaSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Dimmable")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("::")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("在了解 Feature 的构建过程之前，我们先看一下 Feature 的定义：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * A feature that requires {@link DisplayArea DisplayArea(s)}.\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" mName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" mId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" mWindowLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NewDisplayAreaSupplier")]),a._v(" mNewDisplayAreaSupplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ......")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("p",[a._v("Feature 对象会和窗口层级树中的一个 DiaplayArea 对象相关联，用于表示 DiaplayArea 对象管理的显示区域拥有不同的特性。")]),a._v(" "),t("p",[a._v("看一下它的成员变量：")]),a._v(" "),t("ul",[t("li",[a._v("mName：Feature的名字，如 "),t("code",[a._v("WindowedMagnification HideDisplayCutout")]),a._v(" 之类的，后续 DisplayArea 层级结构建立起来后，每个 DisplayArea 的名字用的就是当前 DisplayArea 对应的那个 Feature 的名字。")]),a._v(" "),t("li",[a._v("mId，Feature 的 ID，如 "),t("code",[a._v("FEATURE_WINDOWED_MAGNIFICATION FEATURE_HIDE_DISPLAY_CUTOUT")]),a._v("，用于指定啊 Feature 的类型")]),a._v(" "),t("li",[a._v("mWindowLayers，一个 boolean 数组，代表了 Feature 关联的 DisplayArea 可以包含哪些层级对应的窗口")]),a._v(" "),t("li",[a._v("mNewDisplayAreaSupplier")])]),a._v(" "),t("p",[a._v("前面说过成员 "),t("code",[a._v("int mId")]),a._v(" 用于指定 Feature 的类型，目前系统有以下几类 feature：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/core/java/android/window/DisplayAreaOrganizer.java")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area hosting the default task container.\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 拥有该 feature 的 DisplayArea 的子节点是 TaskDisPlayArea")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_DEFAULT_TASK_CONTAINER")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area hosting non-activity window tokens.\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// // 拥有该 feature 的 DisplayArea 的子节点是 WindowToken ")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_WINDOW_TOKENS")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area for one handed feature\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 拥有该 feature 的 DisplayArea 指代的区域支持单手模式")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_ONE_HANDED")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area that can be magnified in\n     * {@link Settings.Secure.ACCESSIBILITY_MAGNIFICATION_MODE_WINDOW}. It contains all windows\n     * below {@link WindowManager.LayoutParams#TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY}.\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 在设置中了设置了 Settings.Secure.ACCESSIBILITY_MAGNIFICATION_MODE_WINDOW 属性后， 拥有该 feature 的 DisplayArea 指代的区域，可以放大")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_WINDOWED_MAGNIFICATION")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area that can be magnified in\n     * {@link Settings.Secure.ACCESSIBILITY_MAGNIFICATION_MODE_FULLSCREEN}. This is different from\n     * {@link #FEATURE_WINDOWED_MAGNIFICATION} that the whole display will be magnified.\n     * @hide\n     */")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 在设置中了设置了 Settings.Secure.ACCESSIBILITY_MAGNIFICATION_MODE_FULLSCREEN 属性后， 拥有该 feature 的 DisplayArea 指代的区域，可以放大，与 FEATURE_WINDOWED_MAGNIFICATION 不同的")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_FULLSCREEN_MAGNIFICATION")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n\n\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area for hiding display cutout feature\n     * @hide\n     */")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 拥有该 feature 的 DisplayArea 指代的区域，拥有隐藏刘海屏的功能")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_HIDE_DISPLAY_CUTOUT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area that the IME container can be placed in. Should be enabled on every root\n     * hierarchy if IME container may be reparented to that hierarchy when the IME target changed.\n     * @hide\n     */")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 拥有该 feature 的 DisplayArea 指代的区域，用于放置输入法")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_IME_PLACEHOLDER")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("   \n\n\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n     * Display area hosting IME window tokens (@see ImeContainer). By default, IMEs are parented\n     * to FEATURE_IME_PLACEHOLDER but can be reparented under other RootDisplayArea.\n     *\n     * This feature can register organizers in order to disable the reparenting logic and manage\n     * the position and settings of the container manually. This is useful for foldable devices\n     * which require custom UX rules for the IME position (e.g. IME on one screen and the focused\n     * app on another screen).\n     */")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// FEATURE_IME_PLACEHOLDER 的子节点，用于放置输入法")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_IME")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FEATURE_SYSTEM_FIRST")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br"),t("span",{staticClass:"line-number"},[a._v("38")]),t("br"),t("span",{staticClass:"line-number"},[a._v("39")]),t("br"),t("span",{staticClass:"line-number"},[a._v("40")]),t("br"),t("span",{staticClass:"line-number"},[a._v("41")]),t("br"),t("span",{staticClass:"line-number"},[a._v("42")]),t("br"),t("span",{staticClass:"line-number"},[a._v("43")]),t("br"),t("span",{staticClass:"line-number"},[a._v("44")]),t("br"),t("span",{staticClass:"line-number"},[a._v("45")]),t("br"),t("span",{staticClass:"line-number"},[a._v("46")]),t("br"),t("span",{staticClass:"line-number"},[a._v("47")]),t("br"),t("span",{staticClass:"line-number"},[a._v("48")]),t("br"),t("span",{staticClass:"line-number"},[a._v("49")]),t("br"),t("span",{staticClass:"line-number"},[a._v("50")]),t("br"),t("span",{staticClass:"line-number"},[a._v("51")]),t("br"),t("span",{staticClass:"line-number"},[a._v("52")]),t("br"),t("span",{staticClass:"line-number"},[a._v("53")]),t("br"),t("span",{staticClass:"line-number"},[a._v("54")]),t("br"),t("span",{staticClass:"line-number"},[a._v("55")]),t("br"),t("span",{staticClass:"line-number"},[a._v("56")]),t("br"),t("span",{staticClass:"line-number"},[a._v("57")]),t("br"),t("span",{staticClass:"line-number"},[a._v("58")]),t("br"),t("span",{staticClass:"line-number"},[a._v("59")]),t("br"),t("span",{staticClass:"line-number"},[a._v("60")]),t("br"),t("span",{staticClass:"line-number"},[a._v("61")]),t("br"),t("span",{staticClass:"line-number"},[a._v("62")]),t("br"),t("span",{staticClass:"line-number"},[a._v("63")]),t("br"),t("span",{staticClass:"line-number"},[a._v("64")]),t("br"),t("span",{staticClass:"line-number"},[a._v("65")]),t("br"),t("span",{staticClass:"line-number"},[a._v("66")]),t("br"),t("span",{staticClass:"line-number"},[a._v("67")]),t("br"),t("span",{staticClass:"line-number"},[a._v("68")]),t("br"),t("span",{staticClass:"line-number"},[a._v("69")]),t("br"),t("span",{staticClass:"line-number"},[a._v("70")]),t("br")])]),t("p",[a._v("接下来，我们就来看 Feature 对象的具体构建过程。")]),a._v(" "),t("p",[a._v("这里先使用 Feature.Builder 构建一个 Feature 对象：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 构造函数，初始化成员变量")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Builder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerPolicy")]),a._v(" policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                mPolicy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                mName "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                mId "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" id"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                mLayers "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getMaxWindowLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("这里 new 了一个 Feature.Builder 对象，会调用到 Feature.Builder 的构造函数，在构造函数中对成员变量进行了赋值和初始化。")]),a._v(" "),t("p",[a._v("接着调用 Upto 方法：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/**\n             * Set that the feature applies window types that are layerd at or below the layer of\n             * the given window type.\n             */")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Builder")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("upTo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" typeInclusive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" max "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("typeInclusive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" max"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("typeInclusive"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br")])]),t("p",[a._v("前文我们说过在 WMS 中，把 Z 轴的纵向空间划分为 0 到 36 一共 37 个区间，这里传入的参数 "),t("code",[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),a._v(" 是窗口的类型，在 upTo 中会调用 layerFromType 方法将窗口类型转换为该窗口类型对应的 Z 轴区间层级。")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" internalWindows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getWindowLayerFromTypeLw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" internalWindows"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 接着调用 getWindowLayerFromTypeLw 方法")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/policy/WindowManagerPolicy.java")]),a._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getWindowLayerFromTypeLw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" canAddInternalSystemWindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getWindowLayerFromTypeLw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" canAddInternalSystemWindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* roundedCornerOverlay */")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 接着调用 getWindowLayerFromTypeLw 方法")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/policy/WindowManagerPolicy.java")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getWindowLayerFromTypeLw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" canAddInternalSystemWindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" roundedCornerOverlay"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Always put the rounded corner layer to the top most.")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("roundedCornerOverlay "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" canAddInternalSystemWindow"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getMaxWindowLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("FIRST_APPLICATION_WINDOW")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("&&")]),a._v(" type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LAST_APPLICATION_WINDOW")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APPLICATION_LAYER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("switch")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_WALLPAPER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// wallpaper is at the bottom, though the window manager may move it.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_PRESENTATION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_PRIVATE_PRESENTATION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_DOCK_DIVIDER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_QS_DIALOG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_PHONE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SEARCH_BAR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_CONSUMER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_DIALOG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("6")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_TOAST")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// toasts and the plugged-in battery thing")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("7")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_PRIORITY_PHONE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// SIM errors and unlock.  Not sure if this really should be in a high layer.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_ALERT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// like the ANR / app crashed dialogs")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Type is deprecated for non-system apps. For system apps, this type should be")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// in a higher layer than TYPE_APPLICATION_OVERLAY.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  canAddInternalSystemWindow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("12")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_APPLICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("11")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// on-screen keyboards and other such input method user interfaces go here.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("13")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD_DIALOG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// on-screen keyboards and other such input method user interfaces go here.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("14")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_STATUS_BAR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_STATUS_BAR_ADDITIONAL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("16")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NOTIFICATION_SHADE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("17")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_STATUS_BAR_SUB_PANEL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("18")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_KEYGUARD_DIALOG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_VOICE_INTERACTION_STARTING")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("20")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_VOICE_INTERACTION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// voice interaction layer should show above the lock screen.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("21")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_VOLUME_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the on-screen volume indicator and controller shown when the user")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// changes the device volume")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("22")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the on-screen volume indicator and controller shown when the user")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// changes the device volume")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  canAddInternalSystemWindow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("23")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the navigation bar, if available, shows atop most things")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_NAVIGATION_BAR_PANEL")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// some panels (e.g. search) need to show on top of the navigation bar")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("25")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SCREENSHOT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// screenshot selection layer shouldn't go above system error, but it should cover")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// navigation bars at the very least.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("26")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_ERROR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// system-level error dialogs")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  canAddInternalSystemWindow "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("27")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("9")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// used to highlight the magnified portion of a display")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("28")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_DISPLAY_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// used to simulate secondary display devices")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("29")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_DRAG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the drag layer: input for drag-and-drop is associated with this window,")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// which sits above all other focusable windows")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("30")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// overlay put by accessibility services to intercept user interaction")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("31")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("32")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SECURE_SYSTEM_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("33")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_BOOT_PROGRESS")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("34")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("case")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_POINTER")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the (mouse) pointer layer")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("35")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("default")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Slog")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("e")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"WindowManager"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Unknown window type: "')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("                  \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br"),t("span",{staticClass:"line-number"},[a._v("38")]),t("br"),t("span",{staticClass:"line-number"},[a._v("39")]),t("br"),t("span",{staticClass:"line-number"},[a._v("40")]),t("br"),t("span",{staticClass:"line-number"},[a._v("41")]),t("br"),t("span",{staticClass:"line-number"},[a._v("42")]),t("br"),t("span",{staticClass:"line-number"},[a._v("43")]),t("br"),t("span",{staticClass:"line-number"},[a._v("44")]),t("br"),t("span",{staticClass:"line-number"},[a._v("45")]),t("br"),t("span",{staticClass:"line-number"},[a._v("46")]),t("br"),t("span",{staticClass:"line-number"},[a._v("47")]),t("br"),t("span",{staticClass:"line-number"},[a._v("48")]),t("br"),t("span",{staticClass:"line-number"},[a._v("49")]),t("br"),t("span",{staticClass:"line-number"},[a._v("50")]),t("br"),t("span",{staticClass:"line-number"},[a._v("51")]),t("br"),t("span",{staticClass:"line-number"},[a._v("52")]),t("br"),t("span",{staticClass:"line-number"},[a._v("53")]),t("br"),t("span",{staticClass:"line-number"},[a._v("54")]),t("br"),t("span",{staticClass:"line-number"},[a._v("55")]),t("br"),t("span",{staticClass:"line-number"},[a._v("56")]),t("br"),t("span",{staticClass:"line-number"},[a._v("57")]),t("br"),t("span",{staticClass:"line-number"},[a._v("58")]),t("br"),t("span",{staticClass:"line-number"},[a._v("59")]),t("br"),t("span",{staticClass:"line-number"},[a._v("60")]),t("br"),t("span",{staticClass:"line-number"},[a._v("61")]),t("br"),t("span",{staticClass:"line-number"},[a._v("62")]),t("br"),t("span",{staticClass:"line-number"},[a._v("63")]),t("br"),t("span",{staticClass:"line-number"},[a._v("64")]),t("br"),t("span",{staticClass:"line-number"},[a._v("65")]),t("br"),t("span",{staticClass:"line-number"},[a._v("66")]),t("br"),t("span",{staticClass:"line-number"},[a._v("67")]),t("br"),t("span",{staticClass:"line-number"},[a._v("68")]),t("br"),t("span",{staticClass:"line-number"},[a._v("69")]),t("br"),t("span",{staticClass:"line-number"},[a._v("70")]),t("br"),t("span",{staticClass:"line-number"},[a._v("71")]),t("br"),t("span",{staticClass:"line-number"},[a._v("72")]),t("br"),t("span",{staticClass:"line-number"},[a._v("73")]),t("br"),t("span",{staticClass:"line-number"},[a._v("74")]),t("br"),t("span",{staticClass:"line-number"},[a._v("75")]),t("br"),t("span",{staticClass:"line-number"},[a._v("76")]),t("br"),t("span",{staticClass:"line-number"},[a._v("77")]),t("br"),t("span",{staticClass:"line-number"},[a._v("78")]),t("br"),t("span",{staticClass:"line-number"},[a._v("79")]),t("br"),t("span",{staticClass:"line-number"},[a._v("80")]),t("br"),t("span",{staticClass:"line-number"},[a._v("81")]),t("br"),t("span",{staticClass:"line-number"},[a._v("82")]),t("br"),t("span",{staticClass:"line-number"},[a._v("83")]),t("br"),t("span",{staticClass:"line-number"},[a._v("84")]),t("br"),t("span",{staticClass:"line-number"},[a._v("85")]),t("br"),t("span",{staticClass:"line-number"},[a._v("86")]),t("br"),t("span",{staticClass:"line-number"},[a._v("87")]),t("br"),t("span",{staticClass:"line-number"},[a._v("88")]),t("br"),t("span",{staticClass:"line-number"},[a._v("89")]),t("br"),t("span",{staticClass:"line-number"},[a._v("90")]),t("br"),t("span",{staticClass:"line-number"},[a._v("91")]),t("br"),t("span",{staticClass:"line-number"},[a._v("92")]),t("br"),t("span",{staticClass:"line-number"},[a._v("93")]),t("br"),t("span",{staticClass:"line-number"},[a._v("94")]),t("br"),t("span",{staticClass:"line-number"},[a._v("95")]),t("br"),t("span",{staticClass:"line-number"},[a._v("96")]),t("br"),t("span",{staticClass:"line-number"},[a._v("97")]),t("br"),t("span",{staticClass:"line-number"},[a._v("98")]),t("br"),t("span",{staticClass:"line-number"},[a._v("99")]),t("br"),t("span",{staticClass:"line-number"},[a._v("100")]),t("br"),t("span",{staticClass:"line-number"},[a._v("101")]),t("br"),t("span",{staticClass:"line-number"},[a._v("102")]),t("br"),t("span",{staticClass:"line-number"},[a._v("103")]),t("br"),t("span",{staticClass:"line-number"},[a._v("104")]),t("br"),t("span",{staticClass:"line-number"},[a._v("105")]),t("br"),t("span",{staticClass:"line-number"},[a._v("106")]),t("br"),t("span",{staticClass:"line-number"},[a._v("107")]),t("br"),t("span",{staticClass:"line-number"},[a._v("108")]),t("br"),t("span",{staticClass:"line-number"},[a._v("109")]),t("br"),t("span",{staticClass:"line-number"},[a._v("110")]),t("br"),t("span",{staticClass:"line-number"},[a._v("111")]),t("br"),t("span",{staticClass:"line-number"},[a._v("112")]),t("br"),t("span",{staticClass:"line-number"},[a._v("113")]),t("br"),t("span",{staticClass:"line-number"},[a._v("114")]),t("br"),t("span",{staticClass:"line-number"},[a._v("115")]),t("br"),t("span",{staticClass:"line-number"},[a._v("116")]),t("br"),t("span",{staticClass:"line-number"},[a._v("117")]),t("br"),t("span",{staticClass:"line-number"},[a._v("118")]),t("br"),t("span",{staticClass:"line-number"},[a._v("119")]),t("br"),t("span",{staticClass:"line-number"},[a._v("120")]),t("br"),t("span",{staticClass:"line-number"},[a._v("121")]),t("br"),t("span",{staticClass:"line-number"},[a._v("122")]),t("br"),t("span",{staticClass:"line-number"},[a._v("123")]),t("br"),t("span",{staticClass:"line-number"},[a._v("124")]),t("br")])]),t("p",[a._v("layerFromType 方法层层调用，最后其实就是一个 switch 语句，switch 语句将窗口类型转换为该窗口类型对应的 Z 轴区间层级，此处的窗口类型是 "),t("code",[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),a._v("，对应的 Z 轴区间层级是 32。")]),a._v(" "),t("p",[a._v("layerFromType 方法返会的窗口层级 32 保存到局部变量 max 中，接着把 Feature.Builder 的成员变量 "),t("code",[a._v("boolean[] mLayers")]),a._v(" 中 "),t("code",[a._v("[0,32)")]),a._v(" 区间的值设置为 true，当调用 Feature.Builder 对象的 build 方法的时候，会将 mLayers 输出拷贝到返回的 Feature 对象的 "),t("code",[a._v("mWindowLayers")]),a._v(" 成员中。")]),a._v(" "),t("p",[a._v("接着调用 "),t("code",[a._v("set(type, false)")]),a._v(" 方法:")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_APPLICATION_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_ALERT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_OVERLAY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("layerFromType")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_SYSTEM_ERROR")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" value"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("套路类似，调用 layerFromType 方法把窗口类型转换为层级，这里传入的窗口类型是 "),t("code",[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),a._v("，layerFromType 返回 32，接着把 mLayers[32] 设置为 true。")]),a._v(" "),t("p",[a._v("到这里， mLayers 数组， [0,32] 区间为 true，表示关联该 feature 的 DisplayArea 涉及的纵向区间是 [0,32]。")]),a._v(" "),t("p",[a._v("同样的套路调用 except 方法：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Builder")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("except")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" types"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" types"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("length"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" types"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("set")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("传入的参数是 "),t("code",[a._v("TYPE_ACCESSIBILITY_MAGNIFICATION_OVERLAY")]),a._v(", set 方法中同样会调用到 "),t("code",[a._v("getWindowLayerFromTypeLw")]),a._v(" 返回窗口类型对应的层级 32，接着将 mLayers[32] 设置为 false。")]),a._v(" "),t("p",[a._v("到这里， mLayers 数组， "),t("code",[a._v("[0,32)")]),a._v(" 区间为 true，表示关联该 feature 的 DisplayArea 涉及的纵向区间是 [0,32)。")]),a._v(" "),t("p",[a._v("接着调用 "),t("code",[a._v(".setNewDisplayAreaSupplier(DisplayArea.Dimmable::new)")]),a._v(" 方法：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Builder")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setNewDisplayAreaSupplier")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("NewDisplayAreaSupplier")]),a._v(" newDisplayAreaSupplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                mNewDisplayAreaSupplier "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" newDisplayAreaSupplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("实际就是 new 一个 DisplayArea.Dimmable 保存在 Builder 的 mNewDisplayAreaSupplier 成员中。")]),a._v(" "),t("p",[a._v("最后调用 build 方法，new 一个 Feature 返回，前面准备好的数据都作为参数传入构造方法，然后保存到 Feature 中：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mExcludeRoundedCorner"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Always put the rounded corner layer to the top most layer.")]),a._v("\n                    mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getMaxWindowLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mName"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("clone")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mNewDisplayAreaSupplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("这样就构造好了名为 "),t("code",[a._v("WindowedMagnification")]),a._v(" 的 Feature 对象，接着调用 addFeature 将构造好的 Feature 对象保存到 HierarchyBuilder 对象内部的 "),t("code",[a._v("ArrayList<DisplayAreaPolicyBuilder.Feature> mFeatures")]),a._v(" 成员中：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HierarchyBuilder")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addFeature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayAreaPolicyBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Feature")]),a._v(" feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("this")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("后面同样的套路，一共构造了 5 个 Feature 对象，构造完成后，将他们保存到 HierarchyBuilder 对象的 "),t("code",[a._v("ArrayList<DisplayAreaPolicyBuilder.Feature> mFeatures")]),a._v("  成员变量中。5 个 Feature 对象的具体情况如下：")]),a._v(" "),t("p",[a._v("|")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("Feature.mName")]),a._v(" "),t("th",[a._v("Feature.mID")]),a._v(" "),t("th",[a._v("Feature.mWindowLayers 数组为 true 的区间")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("WindowedMagnification")]),a._v(" "),t("td",[a._v("FEATURE_WINDOWED_MAGNIFICATION")]),a._v(" "),t("td",[a._v("[0,31]")])]),a._v(" "),t("tr",[t("td",[a._v("HideDisplayCutout")]),a._v(" "),t("td",[a._v("FEATURE_HIDE_DISPLAY_CUTOUT")]),a._v(" "),t("td",[a._v("[0,14], 16, [18,23], [26,35]")])]),a._v(" "),t("tr",[t("td",[a._v("OneHanded")]),a._v(" "),t("td",[a._v("FEATURE_ONE_HANDED")]),a._v(" "),t("td",[a._v("[0,23], [26,32],[34,35]")])]),a._v(" "),t("tr",[t("td",[a._v("FullscreenMagnification")]),a._v(" "),t("td",[a._v("FEATURE_FULLSCREEN_MAGNIFICATION")]),a._v(" "),t("td",[a._v("[0,12], [15,23], [26,27], [29,31], [33,35]")])]),a._v(" "),t("tr",[t("td",[a._v("ImePlaceholder")]),a._v(" "),t("td",[a._v("FEATURE_IME_PLACEHOLDER")]),a._v(" "),t("td",[a._v("[13,14]")])])])]),a._v(" "),t("p",[a._v("接着就会调用到 "),t("code",[a._v("new DisplayAreaPolicyBuilder().setRootHierarchy(rootHierarchy).build(wmService);")]),a._v(",生成 DisplayArea 层级结构:")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicy.java")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("public")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayAreaPolicy")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerService")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayContent")]),a._v(" content"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RootDisplayArea")]),a._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),a._v(" imeContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ......")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayAreaPolicyBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("setRootHierarchy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("rootHierarchy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("这里先 new 一个 DisplayAreaPolicyBuilder 对象，然后把前面构造好的 HierarchyBuilder 对象设置给 DisplayAreaPolicyBuilder 对象的成员变量，最后调用 build 来构建树结构：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Result")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerService")]),a._v(" wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("validate")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Attach DA group roots to screen hierarchy before adding windows to group hierarchies.")]),a._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 构建树结构")]),a._v("\n        mRootHierarchyBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mDisplayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("RootDisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" displayAreaGroupRoots "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n                mDisplayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// mDisplayAreaGroupHierarchyBuilders 是一个空列表")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" mDisplayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HierarchyBuilder")]),a._v(" hierarchyBuilder "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mDisplayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            hierarchyBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            displayAreaGroupRoots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("hierarchyBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mRoot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Use the default function if it is not specified otherwise.")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mSelectRootForWindowFunc "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            mSelectRootForWindowFunc "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DefaultSelectRootForWindowFunction")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("\n                    mRootHierarchyBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mRoot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" displayAreaGroupRoots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Result")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("wmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mRootHierarchyBuilder"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mRoot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" displayAreaGroupRoots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                mSelectRootForWindowFunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mSelectTaskDisplayAreaFunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br")])]),t("p",[a._v("调用 HierarchyBuilder 对象的 build 方法构建树结构，方法比较长，我们分步查看：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("build")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HierarchyBuilder")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" displayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 初始化一堆局部变量")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerPolicy")]),a._v(" policy "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mRoot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mWmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mPolicy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" maxWindowLayerCount "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getMaxWindowLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 37")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" displayAreaForLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("maxWindowLayerCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowContainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" featureAreas "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayMap")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                featureAreas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("put")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n                 "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 初始化 PendingArea 数组")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" areaForLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("maxWindowLayerCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" root "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// areaForLayer 数组全部填充为 root")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Arrays")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fill")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br")])]),t("p",[a._v("在分析代码之前，我们需要先知道，代码中是先构建一个 PendingArea 对象组层的树，在使用这个树构建出我们的目标窗口容器树。PendingArea 树中的节点与目标窗口容器树中的节点一一对应。")]),a._v(" "),t("p",[a._v("PendingArea 类的定义如下：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n       \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" mMinLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 子节点")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" mChildren "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ArrayList")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 当前节点的 feature")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),a._v(" mFeature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 父节点")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" mParent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" mMaxLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n        "),t("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[a._v("@Nullable")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),a._v(" mExisting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" \n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("boolean")]),a._v(" mSkipTokens "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// ......")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br")])]),t("ul",[t("li",[a._v("PendingArea 是一个树的节点，mParent 代表当前节点的父节点，mChildren 表示的是当前节点的子节点。")]),a._v(" "),t("li",[a._v("在 PendingArea 树转换为窗口容器树的过程中，会将 PendingArea 中 mFeature 中的信息传递给对应的 DisplayArea 节点")]),a._v(" "),t("li",[a._v("mMinLayer 和 mMaxLayer 代表的是当前 PendingArea 对应的 DisplayArea 可以容纳的窗口层级值的一个范围。")])]),a._v(" "),t("p",[a._v("为了接下来的分析，根据 PendingArea 的成员变量，可以将 PendingArea 表述为以下形式：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("mFeature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mName"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("mMinLayer"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v("mMaxLayer\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("比如："),t("code",[a._v("OneHanded:0:1")]),a._v("，表示名为 OneHanded 的 PendingArea，对应的 DisplayArea 可以容纳层级值从 0 到 1 的窗口。")]),a._v(" "),t("p",[a._v("root 现在没有一个Feature，因此名字暂时认为是 Root，此时为 "),t("code",[a._v("Root:0:0")])]),a._v(" "),t("p",[a._v("有了这些准备工作后，我们就可以分析后续的代码了：")]),a._v(" "),t("p",[a._v("这部分代码主要是初始化一些局部变量，其中：")]),a._v(" "),t("ul",[t("li",[a._v("PendingArea[] areaForLayer，其长度为 maxWindowLayerCount，maxWindowLayerCount 的值为 36 + 1 = 37")]),a._v(" "),t("li",[t("code",[a._v("Arrays.fill(areaForLayer, root);")]),a._v(" 会将数组中的成员全部初始化为 "),t("code",[a._v("Root:0:0")])])]),a._v(" "),t("p",[a._v("目前，reaForLayer 数组初始化后，所有的成员均为 "),t("code",[a._v("Root:0:0")]),a._v("：")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("areaForLayer[37]")]),a._v(" "),t("th",[a._v("初始")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("areaForLayer[0]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[1]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[2]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[3]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[4]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[5]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[6]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[7]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[8]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[9]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[10]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[11]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[12]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[13]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[14]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[15]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[16]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[17]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[18]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[19]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[20]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[21]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[22]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[23]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[24]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[25]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[26]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[27]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[28]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[29]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[30]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[31]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[32]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[33]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[34]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[35]")]),a._v(" "),t("td",[a._v("Root:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[36]")]),a._v(" "),t("td",[a._v("Root:0:0")])])])]),a._v(" "),t("p",[a._v("我们接着看 build 方法后续的代码：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("           \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create DisplayAreas to cover all defined features.")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 遍历每一个 Feature")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" size "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Traverse the features with the order they are defined, so that the early defined")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// feature will be on the top in the hierarchy.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),a._v(" feature "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// maxWindowLayerCount 值为 37")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" maxWindowLayerCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mWindowLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// This feature will be applied to this window layer.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We need to find a DisplayArea for it:")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We can reuse the existing one if it was created for this feature for the")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// previous layer AND the last feature that applied to the previous layer is")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the same as the feature that applied to the current layer (so they are ok")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// to share the same parent DisplayArea).")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" featureArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mParent "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// No suitable DisplayArea:")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create a new one under the previous area (as parent) for this layer.")]),a._v("\n                            featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                            areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("featureArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                        areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" featureArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// This feature won't be applied to this window layer. If it needs to be")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// applied to the next layer, we will need to create a new DisplayArea for")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// that.")]),a._v("\n                        featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br")])]),t("p",[a._v("这里会将之前初始化好的 5 个 Feature 对象遍历一次，每个 Feature 对象都会走相同的一次流程。")]),a._v(" "),t("p",[a._v("我们先看名为 "),t("code",[a._v("WindowedMagnification")]),a._v(" 的 Feature 对象：")]),a._v(" "),t("ul",[t("li",[a._v("在 for 循环中， layer 为 0，此时 feature.mWindowLayers[0] 为 true，featureArea 为 null，那么创建一个 PendingArea 对象 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v("，这个新创建的 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v(" 对象的 parent 是构造方法的第三个参数 areaForLayer[0] "),t("code",[a._v("Root:0:0")]),a._v("，接着将这个新创建的"),t("code",[a._v("WindowedMagnification:0:0")]),a._v(" 添加到 "),t("code",[a._v("areaForLayer[0] Root:0:0")]),a._v(" 的子节点中，最后将 areaForLayer[0] 指向这个新创建的 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v("。")]),a._v(" "),t("li",[a._v("下一次 for 循环，layer为 1，feature.mWindowLayers[1] 为 true，featureArea 为上一次循环创建的"),t("code",[a._v("WindowedMagnification:0:0")]),a._v("，featureArea.mParent 为 "),t("code",[a._v("Root:0:0")]),a._v("，areaForLayer[1] 也是 "),t("code",[a._v("Root:0:0")]),a._v("，那么不新创建 PendingArea 对象，将 areaForLayer[1] 指向上一次循环创建的 "),t("code",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("li",[a._v("后续直到 layer 为 32 之前，都是如此。当 layer 为 32 时，feature.mWindowLayers[32] 为 false，不会走到这些逻辑中。")])]),a._v(" "),t("p",[a._v("for 循环完成后，areaForLayer 数组的情况是：")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("areaForLayer[37]")]),a._v(" "),t("th",[a._v("初始")]),a._v(" "),t("th",[a._v("WindowedMagnification")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("areaForLayer[0]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[1]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[2]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[3]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[4]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[5]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[6]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[7]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[8]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[9]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[10]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[11]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[12]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[13]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[14]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[15]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[16]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[17]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[18]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[19]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[20]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[21]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[22]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[23]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[24]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[25]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[26]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[27]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[28]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[29]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[30]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[31]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[32]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[33]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[34]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[35]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[36]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td")])])]),a._v(" "),t("p",[a._v("根据前面的分析，当前状态下，PendingArea 树的情况如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/images20240225151657.png",alt:"20240225151657"}})]),a._v(" "),t("p",[a._v("我们接着看名为 "),t("code",[a._v("HideDisplayCutout")]),a._v(" 的 Feature 对象对应的循环过程：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("           \n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create DisplayAreas to cover all defined features.")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 遍历每一个 Feature")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" size "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" size"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Traverse the features with the order they are defined, so that the early defined")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// feature will be on the top in the hierarchy.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),a._v(" feature "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mFeatures"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// maxWindowLayerCount 值为 37")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" maxWindowLayerCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mWindowLayers"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// This feature will be applied to this window layer.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("//")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We need to find a DisplayArea for it:")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We can reuse the existing one if it was created for this feature for the")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// previous layer AND the last feature that applied to the previous layer is")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// the same as the feature that applied to the current layer (so they are ok")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// to share the same parent DisplayArea).")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" featureArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mParent "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// No suitable DisplayArea:")]),a._v("\n                            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create a new one under the previous area (as parent) for this layer.")]),a._v("\n                            featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("feature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                            areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("featureArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                        areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" featureArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// This feature won't be applied to this window layer. If it needs to be")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// applied to the next layer, we will need to create a new DisplayArea for")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// that.")]),a._v("\n                        featureArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br")])]),a._v(" "),t("ul",[t("li",[a._v("在第一次 for 循环，layer 为 0，此时 feature.mWindowLayers[0] 为 true，featureArea 为 null，那么创建一个 PendingArea 对象 "),t("code",[a._v("HideDisplayCutout:0:0")]),a._v("，这个新创建的 "),t("code",[a._v("HideDisplayCutout:0:0")]),a._v("，parent 设置为 areaForLayer[0]，但是经过第一个 Feature 对象的处理，areaForLayer[0] 此时已经从"),t("code",[a._v("Root:0:0")]),a._v(" 被替换为了 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v("。接着将这个新创建的 "),t("code",[a._v("HideDisplayCutout:0:0")]),a._v(" 添加到"),t("code",[a._v("WindowedMagnification:0:0")]),a._v(" 的子节点中，最后将 areaForLayer[0] 指向这个新创建的"),t("code",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("li",[a._v("layer 为 1，此时 feature.mWindowLayers[1] 为 true，featureArea 为 "),t("code",[a._v("HideDisplayCutout:0:0")]),a._v("，featureArea.mParent 为 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v("，areaForLayer[1] 也是 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v("，那么不创建 PendingArea 对象，将 areaForLayer[1] 指向"),t("code",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("li",[a._v("后续直到 layer 为 14，都是如此")]),a._v(" "),t("li",[a._v("layer 为 15，此时 feature.mWindowLayers[15] 为 false，将 featureArea 重置为 null")]),a._v(" "),t("li",[a._v("layer 为 16，此时 feature.mWindowLayers[16] 为 true，重新创建了一个 PendingArea "),t("code",[a._v("HideDisplayCutout:16:0")]),a._v("，接着将这个新创建的 "),t("code",[a._v("HideDisplayCutout:16:0")]),a._v(" 添加到 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v(" 的子节点中，最后将 areaForLayer[16] 指向这个新创建的"),t("code",[a._v("HideDisplayCutout:16:0")]),a._v("。")]),a._v(" "),t("li",[a._v("layer 为 17，此时 feature.mWindowLayers[17] 为 false，将 featureArea 重置为 null。")]),a._v(" "),t("li",[a._v("laye 为 18，此时 feature.mWindowLayers[18] 为 true，重新创建了一个 PendingArea "),t("code",[a._v("HideDisplayCutout:18:0")]),a._v(" ，接着将这个新创建的 "),t("code",[a._v("HideDisplayCutout:18:0")]),a._v(" 添加到 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v(" 的子节点中，最后将 areaForLayer[18] 指向这个新创建的"),t("code",[a._v("HideDisplayCutout:18:0")]),a._v("。")]),a._v(" "),t("li",[a._v("后续直到 layer 为 23，都是复用的 "),t("code",[a._v("HideDisplayCutout:18:0")]),a._v("。")]),a._v(" "),t("li",[a._v("layer 为 24，此时 feature.mWindowLayers[24] 为 false，将 featureArea 重置为 null。")]),a._v(" "),t("li",[a._v("layer 为 25，此时 feature.mWindowLayers[25] 为 false，将 featureArea 重置为 null。")]),a._v(" "),t("li",[a._v("layer为 26，此时 feature.mWindowLayers[26] 为 true，重新创建了一个 PendingArea："),t("code",[a._v("HideDisplayCutout:26:0")]),a._v("，接着将这个新创建的 "),t("code",[a._v("HideDisplayCutout:26:0")]),a._v(" 添加到"),t("code",[a._v("WindowedMagnification:0:0")]),a._v(" 的子节点中，最后将 areaForLayer[26] 指向这个新创建的 "),t("code",[a._v("HideDisplayCutout:26:0")]),a._v("。")]),a._v(" "),t("li",[a._v("直到 layer 为 31，都是复用的 "),t("code",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("li",[a._v("layer 为 32，此时 feature.mWindowLayers[32] 为 true，此时 featureArea 为 "),t("code",[a._v("HideDisplayCutout:26:0")]),a._v("，featureArea 的 parent 为 "),t("code",[a._v("WindowedMagnification:0:0")]),a._v("，但是此时 areaForLayer[32] 是"),t("code",[a._v("Root:0:0")]),a._v("，那么此时会重新创建一个 PendingArea "),t("code",[a._v("HideDisplayCutout:32:0")]),a._v("，接着将这个新创建的"),t("code",[a._v("HideDisplayCutout:32:0")]),a._v(" 添加到 "),t("code",[a._v("Root:0:0")]),a._v(" 的子节点中，最后将 areaForLayer[32] 指向这个新创建的"),t("code",[a._v("HideDisplayCutout:32:0")]),a._v("。")]),a._v(" "),t("li",[a._v("后续直到 layer 为 35，都是复用的 "),t("code",[a._v("HideDisplayCutout:32")])]),a._v(" "),t("li",[a._v("layer 为 36，此时 feature.mWindowLayers[36] 为 false，将 featureArea 重置为 null")])]),a._v(" "),t("p",[a._v("areaLayer 数组的结构如下：")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("areaForLayer[37]")]),a._v(" "),t("th",[a._v("初始")]),a._v(" "),t("th",[a._v("WindowedMagnification")]),a._v(" "),t("th",[a._v("HideDisplayCutout")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("areaForLayer[0]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[1]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[2]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[3]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[4]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[5]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[6]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[7]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[8]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[9]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[10]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[11]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[12]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[13]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[14]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[15]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[16]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:16:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[17]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[18]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[19]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[20]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[21]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[22]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[23]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[24]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[25]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[26]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[27]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[28]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[29]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[30]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[31]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[32]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[33]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[34]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[35]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[36]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td")])])]),a._v(" "),t("p",[a._v("到目前为止，PendingArea 树的结构如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/images20240225160044.png",alt:"20240225160044"}})]),a._v(" "),t("p",[a._v("后续一个 Feature 处理的分析类似，这里就不重复了，最后 areaLayer 数组的结构如下：\n")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("areaForLayer[37]")]),a._v(" "),t("th",[a._v("初始")]),a._v(" "),t("th",[a._v("WindowedMagnification")]),a._v(" "),t("th",[a._v("HideDisplayCutout")]),a._v(" "),t("th",[a._v("OneHanded")]),a._v(" "),t("th",[a._v("FullscreenMagnification")]),a._v(" "),t("th",[a._v("ImePlaceholder")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("areaForLayer[0]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[1]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[2]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[3]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[4]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[5]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[6]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[7]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[8]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[9]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[10]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[11]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[12]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:0:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[13]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("ImePlaceholder:13:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[14]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:0:0")]),a._v(" "),t("td",[a._v("OneHanded:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("ImePlaceholder:13:0")])]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[15]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("OneHanded:15:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:15:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[16]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:16:0")]),a._v(" "),t("td",[a._v("OneHanded:16:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:16:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[17]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("OneHanded:17:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:17:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[18]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")]),a._v(" "),t("td",[a._v("OneHanded:18:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:18:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[19]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")]),a._v(" "),t("td",[a._v("OneHanded:18:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:18:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[20]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")]),a._v(" "),t("td",[a._v("OneHanded:18:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:18:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[21]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")]),a._v(" "),t("td",[a._v("OneHanded:18:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:18:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[22]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")]),a._v(" "),t("td",[a._v("OneHanded:18:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:18:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[23]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:18:0")]),a._v(" "),t("td",[a._v("OneHanded:18:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:18:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[24]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[25]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[26]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")]),a._v(" "),t("td",[a._v("OneHanded:26:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:26:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[27]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")]),a._v(" "),t("td",[a._v("OneHanded:26:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:26:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[28]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")]),a._v(" "),t("td",[a._v("OneHanded:26:0")]),a._v(" "),t("td"),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[29]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")]),a._v(" "),t("td",[a._v("OneHanded:26:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:29:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[30]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")]),a._v(" "),t("td",[a._v("OneHanded:26:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:29:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[31]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td",[a._v("WindowedMagnification:0:0")]),a._v(" "),t("td",[a._v("HideDisplayCutout:26:0")]),a._v(" "),t("td",[a._v("OneHanded:26:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:29:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[32]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")]),a._v(" "),t("td",[a._v("OneHanded:32:0")]),a._v(" "),t("td"),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[33]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("FullscreenMagnification:33:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[34]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")]),a._v(" "),t("td",[a._v("OneHanded:34:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:34:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[35]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td",[a._v("HideDisplayCutout:32:0")]),a._v(" "),t("td",[a._v("OneHanded:34:0")]),a._v(" "),t("td",[a._v("FullscreenMagnification:34:0")]),a._v(" "),t("td")]),a._v(" "),t("tr",[t("td",[a._v("areaForLayer[36]")]),a._v(" "),t("td",[a._v("Root:0:0")]),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td"),a._v(" "),t("td")])])]),a._v(" "),t("p",[a._v("对应的 PendingArea 树的结构如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/imagesPendingArea%E6%A0%91%E5%88%9D%E6%AD%A53.png",alt:"PendingArea树初步3"}})]),a._v(" "),t("h2",{attrs:{id:"_3-叶子节点生成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-叶子节点生成"}},[a._v("#")]),a._v(" 3. 叶子节点生成")]),a._v(" "),t("p",[a._v("接下来的 build 方法的代码生成叶子节点：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create Tokens as leaf for every layer.")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" leafArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" leafType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_TOKENS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" maxWindowLayerCount"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 获取叶子节点类型")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("typeOfLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Check whether we can reuse the same Tokens with the previous layer. This happens")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// if the previous layer is the same type as the current layer AND there is no")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// feature that applies to only one of them.")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mParent "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" leafType"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Create a new Tokens for this layer.")]),a._v("\n                    leafArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* feature */")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    leafType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_TASK_CONTAINERS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We use the passed in TaskDisplayAreas for task container type of layer.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Skip creating Tokens even if there is no TDA.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addTaskDisplayAreasToApplicationLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addDisplayAreaGroupsToApplicationLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                displayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mSkipTokens "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_IME_CONTAINERS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We use the passed in ImeContainer for ime container type of layer.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Skip creating Tokens even if there is no ime container.")]),a._v("\n                        leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mExisting "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mImeContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mSkipTokens "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mMaxLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br")])]),t("p",[a._v("这里给 PendingArea 树生成叶子节点。")]),a._v(" "),t("p",[a._v("首先调用 typeOfLayer 方法，获取叶子节点类型：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("static")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("typeOfLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowManagerPolicy")]),a._v(" policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APPLICATION_LAYER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 2")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_TASK_CONTAINERS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getWindowLayerFromTypeLw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" \n                    "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("||")]),a._v(" layer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" policy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getWindowLayerFromTypeLw")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("TYPE_INPUT_METHOD_DIALOG")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 13 14 ")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_IME_CONTAINERS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 其他")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_TOKENS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("ul",[t("li",[a._v("layer 等于 2，叶子节点类型是 LEAF_TYPE_TASK_CONTAINERS")]),a._v(" "),t("li",[a._v("layer 等于 13 14，叶子节点类型是 LEAF_TYPE_IME_CONTAINERS")]),a._v(" "),t("li",[a._v("layer 不等于 2,13,14，叶子节点类型是 LEAF_TYPE_TOKENS")])]),a._v(" "),t("p",[a._v("接着 new 一个 PendingArea 对象，然后添加到 areaForLayer[layer] 的子节点中，成为叶子节点。")]),a._v(" "),t("p",[a._v("如果叶子节点类型是 LEAF_TYPE_IME_CONTAINERS，也就是 layer 等于 2，则做以下处理：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_TASK_CONTAINERS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We use the passed in TaskDisplayAreas for task container type of layer.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Skip creating Tokens even if there is no TDA.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addTaskDisplayAreasToApplicationLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// displayAreaGroupHierarchyBuilders是一个空的列表,这个方法就不用管了")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addDisplayAreaGroupsToApplicationLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("layer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                                displayAreaGroupHierarchyBuilders"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mSkipTokens "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" \n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br")])]),t("p",[a._v("接着调用 "),t("code",[a._v("addTaskDisplayAreasToApplicationLayer")]),a._v(" 方法，给 areaForLayer[layer] 再添加一个叶子节点。")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addTaskDisplayAreasToApplicationLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" parentPendingArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" count "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mTaskDisplayAreas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" leafArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("/* feature */")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APPLICATION_LAYER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" parentPendingArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mExisting "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mTaskDisplayAreas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mMaxLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APPLICATION_LAYER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                parentPendingArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br")])]),t("p",[a._v("此时的 mTaskDisplayAreas 中只有一个元素，即名为 "),t("code",[a._v("DefaultTaskDisplayArea")]),a._v(" 的 TaskDisplayArea 对象，这里是为该对象创建了一个对应的 PendingArea 对象，并且将创建的 PendingArea 添加到 areaForLayer[2] 节点之下，然后将 PendingArea.mExisting 设置为 "),t("code",[a._v("DefaultTaskDisplayArea")]),a._v("。后续根据 PendingArea 生成 DisplayArea.Tokens 的时候，如果 mExisting 不为空，那么直接用 mExisting，而不会再重新创建一个 DisplayArea.Tokens 对象。接着将叶子节点 leafArea 的 mSkipTokens 设置为 true，那么后续在根据PendingArea 树生成 DisplayArea 层级结构的时候，就不会为这个 PendingArea 对象生成一个 DisplayArea 对象了。")]),a._v(" "),t("p",[a._v("如果叶子节点类型是 LEAF_TYPE_TASK_CONTAINERS，也就是 layer 等于 13 或者 14，则做以下处理：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leafType "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("LEAF_TYPE_IME_CONTAINERS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// We use the passed in ImeContainer for ime container type of layer.")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Skip creating Tokens even if there is no ime container.")]),a._v("\n                        leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mExisting "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mImeContainer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                        leafArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mSkipTokens "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br")])]),t("p",[a._v("和上面分析类似，后续根据 PendingArea 生成 DisplayArea.Tokens 的时候，不再为当前节点生成 DisplayArea.Tokens，而是用之前保存在 HierarchyBuilder.mImeContainer 的 ImeContainer")]),a._v(" "),t("p",[a._v("树节点生成完成后，PendingArea 树的结构如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/imagesPendingArea%E6%A0%91.png",alt:"PendingArea树"}})]),a._v(" "),t("p",[a._v("接着调用 computeMaxLayer 计算非叶子节点的 mMaxLayer。")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("            root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("computeMaxLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("在此之前，非叶子节点的 mMaxLayer 都是 0，这里调用 computerMaxLayer 方法，将这些值计算出来：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// frameworks/base/services/core/java/com/android/server/wm/DisplayAreaPolicyBuilder.java")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("computeMaxLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                mMaxLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Math")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("max")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mMaxLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("computeMaxLayer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" mMaxLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br")])]),t("p",[a._v("一个递归调用，以当前节点为起点，向下查找最大的那个节点 mMaxLayer 作为当前节点的 mMaxLayer，递归到叶子节点，然后逐级返回。这样每一个的 mMaxLayer 就计算出来了。")]),a._v(" "),t("p",[a._v("至此，PendingArea 树就构造好了，其结构如下：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/imagesPendingArea%E6%A0%91%E5%AE%8C%E5%85%A8%E4%BD%93.png",alt:"PendingArea树完全体"}})]),a._v(" "),t("h2",{attrs:{id:"_4-生成-displayarea-层级结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-生成-displayarea-层级结构"}},[a._v("#")]),a._v(" 4. 生成 DisplayArea 层级结构")]),a._v(" "),t("p",[a._v("PendingArea 树就构造好以后，就会调用下面的方法，基于 PendingArea 树生成 DisplayArea 层级结构")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        root"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiateChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mRoot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" displayAreaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" featureAreas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br")])]),t("p",[a._v("instantiateChildren 方法具体实现如下：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("void")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiateChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" level"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Map")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Feature")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("List")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowContainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" areas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Comparator")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("comparingInt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("pendingArea "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("->")]),a._v(" pendingArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mMinLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("int")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("size")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("++")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PendingArea")]),a._v(" child "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" mChildren"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),a._v(" area "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" child"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("createArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("area "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// TaskDisplayArea and ImeContainer can be set at different hierarchy, so it can")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// be null.")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("continue")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("addChild")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("area"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("WindowContainer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("POSITION_TOP")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("child"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mFeature "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    areas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("child"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mFeature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("area"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 递归调用")]),a._v("\n                child"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("instantiateChildren")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("area"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" level "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areas"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br")])]),t("p",[a._v("当前 root 是上面的生成的 PendingArea 层级结构的根节点，传入的 parent 则是一个 DisplayContent 对象，那么这里按照 root 的 mChildren 的层级结构，以 parent 为根节点，递归调用的方式生成一个 DisplayArea 层级结构。")]),a._v(" "),t("p",[a._v("重点看一下这里创建 DisplayArea 的 DisplayAreaPolicyBuilder.PendingArea.createArea 方法：")]),a._v(" "),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[a._v("        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("private")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("createArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),t("span",{pre:!0,attrs:{class:"token generics"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v(" parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 当mExisting不为null，前面分析的 TaskDisplayArea 和 ImeContainer 的情况，此时不需要再创建 DisplayArea 对象，直接用mExisting")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mExisting "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mExisting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("asTokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("!=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Store the WindowToken container for layers")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fillAreaForLayers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mExisting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("asTokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" mExisting"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// mSkipTokens 为 true，直接 return，mSkipTokens 是和 mExisting 是同一个逻辑下设置的。")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mSkipTokens"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// DisplayArea 的类型")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Type")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mMinLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APPLICATION_LAYER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ABOVE_TASKS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mMaxLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("APPLICATION_LAYER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("BELOW_TASKS")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                type "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("ANY")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n            "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// Leaf 节点处理")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("if")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("mFeature "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("==")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("null")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),a._v(" leaf "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DisplayArea"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("Tokens")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mWmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Leaf:"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" mMinLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('":"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" mMaxLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("fillAreaForLayers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("leaf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" areaForLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" leaf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("else")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 创建 DisplayArea 对象")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("return")]),a._v(" mFeature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mNewDisplayAreaSupplier"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("parent"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mWmService"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" type"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                        mFeature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mName "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('":"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" mMinLayer "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('":"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" mMaxLayer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" mFeature"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("mId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br"),t("span",{staticClass:"line-number"},[a._v("12")]),t("br"),t("span",{staticClass:"line-number"},[a._v("13")]),t("br"),t("span",{staticClass:"line-number"},[a._v("14")]),t("br"),t("span",{staticClass:"line-number"},[a._v("15")]),t("br"),t("span",{staticClass:"line-number"},[a._v("16")]),t("br"),t("span",{staticClass:"line-number"},[a._v("17")]),t("br"),t("span",{staticClass:"line-number"},[a._v("18")]),t("br"),t("span",{staticClass:"line-number"},[a._v("19")]),t("br"),t("span",{staticClass:"line-number"},[a._v("20")]),t("br"),t("span",{staticClass:"line-number"},[a._v("21")]),t("br"),t("span",{staticClass:"line-number"},[a._v("22")]),t("br"),t("span",{staticClass:"line-number"},[a._v("23")]),t("br"),t("span",{staticClass:"line-number"},[a._v("24")]),t("br"),t("span",{staticClass:"line-number"},[a._v("25")]),t("br"),t("span",{staticClass:"line-number"},[a._v("26")]),t("br"),t("span",{staticClass:"line-number"},[a._v("27")]),t("br"),t("span",{staticClass:"line-number"},[a._v("28")]),t("br"),t("span",{staticClass:"line-number"},[a._v("29")]),t("br"),t("span",{staticClass:"line-number"},[a._v("30")]),t("br"),t("span",{staticClass:"line-number"},[a._v("31")]),t("br"),t("span",{staticClass:"line-number"},[a._v("32")]),t("br"),t("span",{staticClass:"line-number"},[a._v("33")]),t("br"),t("span",{staticClass:"line-number"},[a._v("34")]),t("br"),t("span",{staticClass:"line-number"},[a._v("35")]),t("br"),t("span",{staticClass:"line-number"},[a._v("36")]),t("br"),t("span",{staticClass:"line-number"},[a._v("37")]),t("br")])]),t("ul",[t("li",[a._v("当 mExisting 不为 null，就是前面分析的 TaskDisplayArea 和 ImeContainer 的情况，此时不需要再创建 DisplayArea 对象，直接用 mExisting")]),a._v(" "),t("li",[a._v("mSkipTokens 为 true，直接 return，mSkipTokens 是和 mExisting 是同一个逻辑下设置的")]),a._v(" "),t("li",[a._v("这里根据mMinLayer和mMaxLayer的值，将DisplayArea分为三种：\n"),t("ul",[t("li",[a._v("mMaxLayer 小于 APPLICATION_LAYER，即2，这类 DisplayArea 类型为 ABOVE_TASKS")]),a._v(" "),t("li",[a._v("mMinLayer 大于 APPLICATION_LAYER，这类 DisplayArea 类型为 BELOW_TASKS。")]),a._v(" "),t("li",[a._v("剩余情况下的 DisplayArea 类型为 ANY。")])])]),a._v(" "),t("li",[a._v("mFeature 为 null，那么创建一个 DisplayArea.Tokens 对象，也就是 Leaf 节点的情况")]),a._v(" "),t("li",[a._v("如果 mFeature不为 null，那么创建一个 DisplayArea 对象，注意这里构造函数 name 参数传入的是 "),t("code",[a._v('mFeature.mName + ":" + mMinLayer + ":" + mMaxLayer')]),a._v("，包含了 Feature 名，纵向层级范围信息。")])]),a._v(" "),t("p",[a._v("至此，整个窗口层级树就构造好了：")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages@main/images%E7%AA%97%E5%8F%A3%E5%B1%82%E7%BA%A7%E6%A0%91.png",alt:"窗口层级树"}})]),a._v(" "),t("p",[a._v("接下来我们就可以向这颗树添加窗口了。")]),a._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://juejin.cn/post/7140289958085935141",target:"_blank",rel:"noopener noreferrer"}},[a._v("3【Android 12】DisplayArea层级结构（一） —— DisplayArea层级结构的生成"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/yimelancholy/article/details/132213111?spm=1001.2014.3001.5502",target:"_blank",rel:"noopener noreferrer"}},[a._v("Android T 窗口层级其二 —— 层级结构树的构建"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/learnframework/article/details/129115725",target:"_blank",rel:"noopener noreferrer"}},[a._v("android 13 WMS/AMS系统开发-窗口层级相关DisplayArea,WindowContainer第二节"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://blog.csdn.net/shensky711/article/details/121530510",target:"_blank",rel:"noopener noreferrer"}},[a._v("Android 12 - WMS 层级结构 && DisplayAreaGroup 引入"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"关于"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关于"}},[a._v("#")]),a._v(" 关于")]),a._v(" "),t("p",[a._v("我叫阿豪，2015 年本科毕业于国防科学技术大学指挥信息系统专业，毕业后从事信息化装备的研发工作，工作内容主要涉及 Android Framework 与 Linux Kernel。")]),a._v(" "),t("p",[a._v("如果你对 Android Framework 感兴趣或者正在学习 Android Framework，可以关注我的微信公众号和抖音，我会持续分享我的学习经验，帮助正在学习的你少走一些弯路。学习过程中如果你有疑问或者你的经验想要分享给大家可以添加我的微信，我拉你进技术交流群。")]),a._v(" "),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/zzh0838/MyImages@main/img/%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);