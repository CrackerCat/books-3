(window.webpackJsonp=window.webpackJsonp||[]).push([[170],{593:function(a,t,s){"use strict";s.r(t);var n=s(2),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("p",[a._v("上一节源码分析中我们知道，BootAnimation 会从以下几个目录中加载动画文件：")]),a._v(" "),t("ul",[t("li",[a._v("/system/media/bootanimation-encrypted.zip  (if getprop(\"vold.decrypt\") = '1')")]),a._v(" "),t("li",[a._v("/system/media/bootanimation.zip")]),a._v(" "),t("li",[a._v("/oem/media/bootanimation.zip")])]),a._v(" "),t("p",[a._v("知道了这个，自定义开机动画的流程就出来了：")]),a._v(" "),t("ul",[t("li",[a._v("构造好 bootanimation.zip 文件")]),a._v(" "),t("li",[a._v("将 bootanimation.zip 文件预制到以上目录")])]),a._v(" "),t("p",[a._v("那么这里就有几个问题了：")]),a._v(" "),t("ul",[t("li",[a._v("bootanimation.zip 中需要有哪些文件？")]),a._v(" "),t("li",[a._v("这些文件怎么组织？")]),a._v(" "),t("li",[a._v("怎么描述动画的流程")])]),a._v(" "),t("p",[a._v("这里给出一个 bootanimation.zip 未压缩时的结构示例：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("bootanimation/\n├── desc.txt\n├── part0\n│   └── 000.png\n├── part1\n│   └── 001.png\n└── part2\n    └── 002.png\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br")])]),t("p",[a._v("其中 "),t("code",[a._v("part0 part1 part2")]),a._v(" 表示动画的每一个阶段，根据动画的复杂程度，可能还有 part3 part4 part5 等等。")]),a._v(" "),t("p",[a._v("每个 part 中，都保存有至少一张 png 图片。")]),a._v(" "),t("p",[a._v("desc.txt 是动画的脚本文件，用于描述动画的每个阶段，我们通过一个示例来了解其格式：")]),a._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("1080 1920 60    # 宽x高=1080x192, fps=60帧\nc 1 0 part0   # part0 只播放1次,但需全部图片都播放，不能打断\nc 1 15 part1  # part1 只播放1次,但需全部图片都播放，不能打断,在播放结束时延迟15帧，即15/fps=1/60=1/4秒\np 0 0 part2   # part2 循环播放，直到系统启动完成，当 `service.bootanim.exit` 属性设置为 1 时，打断播放\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("ul",[t("li",[a._v("第一行：1080 1920 是动画区域的大小，单位是像素，60 是 60 帧每秒")]),a._v(" "),t("li",[a._v("第二行：c 1 0 part0\n"),t("ul",[t("li",[a._v("第一个参数 c 表示 "),t("code",[a._v("service.bootanim.exit")]),a._v(" 属性设置为 1 时，动画不会被打断，第一个参数如果是 p，表示 "),t("code",[a._v("service.bootanim.exit")]),a._v(" 属性设置为 1 时，动画会被打断")]),a._v(" "),t("li",[a._v("c 后面第 1 个参数：1 是播放一次, 0 表示无限循环直至开机完成。")]),a._v(" "),t("li",[a._v("c 后面第 2 个参数： 数字表示阶段（part）间隔时间，0 表示没有间隔时间")]),a._v(" "),t("li",[a._v("c 后面第 3 个参数：为对应的步骤文件夹")])])]),a._v(" "),t("li",[a._v("后面几行和第二行类似")])]),a._v(" "),t("p",[a._v("准备好以上的文件就可以打包了：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 安装好 zip")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("apt")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("zip")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" bootanimation/\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("zip")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-0qry")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("*.txt "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("*.png "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("*.wav @ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("..")]),a._v("/bootanimation.zip *.txt part*\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[a._v("执行完以上命令后，就可以在 bootanimation 的同级目录找到 bootanimation.zip 文件了。")]),a._v(" "),t("p",[a._v("接着我们把 bootanimation.zip 动画文件预制到 "),t("code",[a._v("/system/media/")]),a._v(" 目录下：")]),a._v(" "),t("p",[a._v("把 bootanimation.zip 动画文件移动到 "),t("code",[a._v("device/jelly/rice14")]),a._v(" 文件中。")]),a._v(" "),t("p",[a._v("在我们的自定义 Product 配置文件 "),t("code",[a._v("device/jelly/rice14/rice14.mk")]),a._v(" 中添加如下内容")]),a._v(" "),t("div",{staticClass:"language-makefile line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-makefile"}},[t("code",[a._v("PRODUCT_COPY_FILES "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v(" \\\n"),t("span",{pre:!0,attrs:{class:"token target symbol"}},[a._v("     "),t("span",{pre:!0,attrs:{class:"token variable"}},[a._v("$")]),a._v("(LOCAL_PATH)/bootanimation.zip")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("/system/media/bootanimation.zip\n\nPRODUCT_ARTIFACT_PATH_REQUIREMENT_WHITELIST "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+=")]),a._v("\\ \n    /system/media/bootanimation.zip\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br")])]),t("p",[a._v("接着重新编译系统，启动虚拟机就可以看到自定义的开机界面了：")]),a._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("source")]),a._v(" build/envsetup.sh\nlunch rice14-eng\nm\nemulator\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/stingerzou/MyImages//20231228233551.png",alt:""}})]),a._v(" "),t("h2",{attrs:{id:"参考资料"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://android.googlesource.com/platform/frameworks/base/+/master/cmds/bootanimation/FORMAT.md",target:"_blank",rel:"noopener noreferrer"}},[a._v("bootanimation format"),t("OutboundLink")],1)]),a._v(" "),t("li",[t("a",{attrs:{href:"https://juejin.cn/post/7102787176789884965",target:"_blank",rel:"noopener noreferrer"}},[a._v("基于Android P，自定义Android开机动画的方法"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);