(window.webpackJsonp=window.webpackJsonp||[]).push([[210],{631:function(a,s,t){"use strict";t.r(s);var n=t(2),e=Object(n.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"android-ams-完全剖析-补充知识之-android-中的各种-id"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#android-ams-完全剖析-补充知识之-android-中的各种-id"}},[a._v("#")]),a._v(" Android AMS 完全剖析 —— 补充知识之 Android 中的各种 ID")]),a._v(" "),s("p",[a._v("在分析 Activity 的启动过程中会涉及到 Android 中的各种各样的 ID，很多同学不太清楚这些 ID 的作用和区别，本文做一个简单的介绍.")]),a._v(" "),s("h2",{attrs:{id:"_1-linux-中的-uid-与-gid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-linux-中的-uid-与-gid"}},[a._v("#")]),a._v(" 1. Linux 中的 uid 与 gid")]),a._v(" "),s("p",[a._v("Linux 是一个多用户操作系统，系统中可以同时存在有多个用户。")]),a._v(" "),s("p",[a._v("每个用户有一个用户名，也就是我们登录时输入的的用户名。用户名在系统中会对应一个整数值 UID，是用户在系统中的唯一标识，就像现实生活中一个身份证号标识一个具体的人。")]),a._v(" "),s("p",[a._v("在终端中可以通过 whoami 打印当前登录的用户名：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("whoami")]),a._v("\nzzh0838\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("可以通过 id 命令查看 uid")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("uid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("zzh0838"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("gid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("zzh0838"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("groups")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("zzh0838"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("adm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cdrom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",27"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sudo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",30"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("dip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",46"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("plugdev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",120"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("lpadmin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",132"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("lxd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",133"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sambashare"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("**\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("输出的第一组数据 "),s("code",[a._v("uid=1000(zzh0838)")]),a._v(" 表示当前用户 zzh0838 的 uid 是 1000。")]),a._v(" "),s("p",[a._v("为了方便管理系统中的多个用户，系统将用户进行了分组，每个用户可以在一个或者多个组中。每个组也有自己的组名和组 id（gid）。一个用户可以同时在多个组中。这个有点类似大学里面的社团，一个社团就是一个用户组，一个学生就是一个用户，一个学生可以同时参加多个社团，就是说一个用户可以同时属于多个用户组。")]),a._v(" "),s("p",[a._v("我们可以通过 id 命令查看当前用户的组信息：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("uid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("zzh0838"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("gid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("zzh0838"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("groups")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("zzh0838"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",4"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("adm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("cdrom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",27"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sudo"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",30"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("dip"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",46"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("plugdev"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",120"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("lpadmin"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",132"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("lxd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(",133"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("sambashare"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("后半部分就是当前用户的用户组信息：")]),a._v(" "),s("p",[s("code",[a._v("gid=1000(zzh0838) groups=1000(zzh0838),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),120(lpadmin),132(lxd),133(sambashare)")])]),a._v(" "),s("p",[s("code",[a._v("gid=1000(zzh0838)")]),a._v(" 表示当前用户的"),s("strong",[a._v("初始组")]),a._v("是 zzh0838，初始组 zzh0838 的 gid 是 1000。每个用户的初始组只能有一个，通常就是将和此用户的用户名相同的组名作为该用户的初始组。")]),a._v(" "),s("p",[a._v("后面的内容就是当前用户所在的组，包括了组名和组 id。")]),a._v(" "),s("h2",{attrs:{id:"_2-android-中的-uid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-android-中的-uid"}},[a._v("#")]),a._v(" 2. Android 中的 uid")]),a._v(" "),s("h3",{attrs:{id:"_2-1-进程的-uid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-进程的-uid"}},[a._v("#")]),a._v(" 2.1 进程的 uid")]),a._v(" "),s("p",[a._v("Andorid 基于 Linux 内核打造，在 Android 4.2 之前，Android 是不支持多用户，但是借用了 linux 的用户体系和文件权限体系实现了 App 之间的数据隔离，所谓数据隔离就是每个 App 有自己的一个数据文件夹，App 只能访问自己的数据文件夹，不能访问其他的 App 的数据文件夹和其他路径下的文件。")]),a._v(" "),s("p",[a._v("那 Android 是怎么实现的呢？")]),a._v(" "),s("p",[a._v("在 App 的安装过程中，会给每个 App 分配一个 userId，这个 userId 保存在手机的 "),s("code",[a._v("/data/system/packages.xml")]),a._v(" 文件中，文件中记录了 App 的包名和 userId 的对应关系。")]),a._v(" "),s("p",[a._v("如果要查看我们的一个 Demo "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 应用的 userId，可以在模拟器的 shell 中执行下面的命令：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" /data/system/packages.xml "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" yuandaima.ahao.myactivitytext             \n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ......")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("package "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"yuandaima.ahao.myactivitytext"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("codePath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/data/app/yuandaima.ahao.myactivitytext-FicL4FdzvHE8_c4bWCbN9A=="')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("nativeLibraryPath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/data/app/yuandaima.ahao.myactivitytext-FicL4FdzvHE8_c4bWCbN9A==/lib"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("publicFlags")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"810073926"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("privateFlags")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ft")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"18cf7636700"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("it")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"18cf76369b1"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("ut")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"18cf76369b1"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("version")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"1"')]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("userId")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"10101"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ......")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br")])]),s("p",[a._v("可以看到应用 yuandaima.ahao.myactivitytext 的 userId 是 10101。")]),a._v(" "),s("p",[a._v("这里的 userId 就是上一节说到的 linux 中的 uid。")]),a._v(" "),s("p",[a._v("在 Linux 系统中，每个进程也有个 uid 属性，表示是哪个用户启动了当前进程，传统的 linux 系统中，用户启动的进程的 uid 都是当前登录的 uid。")]),a._v(" "),s("p",[a._v("在 Android 中有一些差异，每个进程的 uid 属性，在启动时会被设置成 "),s("code",[a._v("data/system/packages.xml")]),a._v(" 文件中记录的进程的 userId。")]),a._v(" "),s("p",[a._v("比如当我们启动 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 应用时，应用的 uid 会被设置为 "),s("code",[a._v("10101")])]),a._v(" "),s("p",[a._v("查看进程信息：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ps")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-elf")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" yuandaima.ahao.myactivitytext                        \nu0_a101       "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4718")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1505")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("13")]),a._v(":27:30 ?     00:00:00 yuandaima.ahao.myactivitytext\nroot          "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4749")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4636")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("13")]),a._v(":33:21 pts/0 00:00:00 "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" yuandaima.ahao.myactivitytext\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br")])]),s("p",[a._v("可以看到启动 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 进程的用户是 u0_a101。")]),a._v(" "),s("p",[a._v("我们接着使用 id 命令看 u0_a101 用户的相关信息：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("id")]),a._v(" u0_a101\n"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("uid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10101")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("u0_a101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("gid")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10101")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("u0_a101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("groups")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10101")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),a._v("u0_a101"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(", "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("context")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("u:r:su:s0\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("可以看到 u0_a101 对应的 uid 是 10101，这个 uid 就是来自 "),s("code",[a._v("data/system/packages.xml")]),a._v(" 文件中记录的进程的 userId。")]),a._v(" "),s("h3",{attrs:{id:"_2-2-应用的数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-应用的数据"}},[a._v("#")]),a._v(" 2.2 应用的数据")]),a._v(" "),s("p",[a._v("Android 中应用的数据通常保存在 "),s("code",[a._v("/data/data")]),a._v(" 目录下：")]),a._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" /data/data\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ls")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-l")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# ......")]),a._v("\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a48         u0_a48         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.timezone.updater\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v(" u0_a77         u0_a77         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.traceur\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a53         u0_a53         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.vpndialogs\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a58         u0_a58         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.wallpaper.livepicker\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" system         system         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.wallpaperbackup\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a83         u0_a83         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.wallpapercropper\ndrwxr-x--x "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a89         u0_a89         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 com.android.wallpaperpicker\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a92         u0_a92         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-13 09:31 com.android.webview\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a95         u0_a95         "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 09:37 org.chromium.webview_shell\ndrwx------ "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" u0_a101        u0_a101        "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4096")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2024")]),a._v("-01-11 "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("15")]),a._v(":18 yuandaima.ahao.myactivitytext\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br"),s("span",{staticClass:"line-number"},[a._v("3")]),s("br"),s("span",{staticClass:"line-number"},[a._v("4")]),s("br"),s("span",{staticClass:"line-number"},[a._v("5")]),s("br"),s("span",{staticClass:"line-number"},[a._v("6")]),s("br"),s("span",{staticClass:"line-number"},[a._v("7")]),s("br"),s("span",{staticClass:"line-number"},[a._v("8")]),s("br"),s("span",{staticClass:"line-number"},[a._v("9")]),s("br"),s("span",{staticClass:"line-number"},[a._v("10")]),s("br"),s("span",{staticClass:"line-number"},[a._v("11")]),s("br"),s("span",{staticClass:"line-number"},[a._v("12")]),s("br"),s("span",{staticClass:"line-number"},[a._v("13")]),s("br")])]),s("p",[a._v("这里的文件夹的名字均为应用的包名，文件夹中保存了对应应用的数据。比如 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 文件夹就保存了 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" app 的数据。")]),a._v(" "),s("p",[a._v("需要注意的是这里文件夹的权限均为 "),s("code",[a._v("rwx------")]),a._v("(除了少数特例)，表示仅文件的所有者可读可写可执行，其他用户均没有读写执行权限。")]),a._v(" "),s("p",[a._v("同时，很重要的一点文件的所属用户和对应 app 进程的所属用户相同。比如 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 文件夹的所属用户是 "),s("code",[a._v("u0_a101")]),a._v("，"),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 进程的所属用户也是 "),s("code",[a._v("u0_a101")]),a._v("。")]),a._v(" "),s("p",[a._v("也就是说 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 文件夹中的文件只能又 "),s("code",[a._v("yuandaima.ahao.myactivitytext")]),a._v(" 进程来读写执行。")]),a._v(" "),s("p",[a._v("这样就利用 linux 的用户体系和文件权限体系实现了 App 之间的数据隔离。妙~")]),a._v(" "),s("h2",{attrs:{id:"_3-android-中的多用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-android-中的多用户"}},[a._v("#")]),a._v(" 3. Android 中的多用户")]),a._v(" "),s("p",[a._v("早期的 Android 并不支持多用户，因为 Linux 本来的多用户体系被用来实现 App 之间的数据隔离了。但是用户对于多用户功能的需求还是存在的。在 Android 4.2 的时候，google 再一次对 Linux 进行了魔改，重新开发了一套多用户体系。")]),a._v(" "),s("p",[a._v("国产手机的分身功能一般就是基于这套魔改的多用户体系实现的。")]),a._v(" "),s("p",[a._v("假设我们的 Android 手机上有两个用户，用户 id 是 0 和 10，这里的 id 在 Android 中称为 UserHandle")]),a._v(" "),s("p",[a._v("我们先登录 id 为 10 的用户，安装一个应用，在 "),s("code",[a._v("data/system/packages.xml")]),a._v(' 中查看， 此应用的 userId="10068"')]),a._v(" "),s("p",[a._v("我们在应用中调用：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Process")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("myUid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 返回值为 1010068")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Process")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("myUserHandle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 返回值为 userHandle{10}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("接着重新登录 id 为 0 的用户，此时是看不到上一步安装的应用，接着我们再次安装同一个应用。在 "),s("code",[a._v("data/system/packages.xml")]),a._v(" 中查看，userId 仍然是 10068")]),a._v(" "),s("p",[a._v("我们在应用中调用：")]),a._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Process")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("myUid")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("   "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 返回值为 10068")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Process")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("myUserHandle")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 返回值为 userHandle{0}")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br"),s("span",{staticClass:"line-number"},[a._v("2")]),s("br")])]),s("p",[a._v("这里可以看出这里的多用户其实是通过 UserHandle 和 userId 的组合来实现的。")]),a._v(" "),s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/yangjj08/p/10239878.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Android的uid与UserHandle"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://blog.csdn.net/xk7298/article/details/102291785",target:"_blank",rel:"noopener noreferrer"}},[a._v("Android中UID、GID和PID的讲解"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.jianshu.com/p/a17c8bed79d9",target:"_blank",rel:"noopener noreferrer"}},[a._v("「Android 安全架构」你真的了解权限机制吗？"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=e.exports}}]);